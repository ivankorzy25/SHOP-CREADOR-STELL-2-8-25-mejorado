<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Test Editor - Selecci√≥n de Productos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.pending {
            background: #fff3cd;
            color: #856404;
        }
        button {
            background: #ff6600;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #e55500;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Test de Interacci√≥n Editor - Productos</h1>
    
    <div class="test-card">
        <h2>Estado del Sistema</h2>
        <div class="status pending" id="server-status">‚è≥ Verificando servidor...</div>
        <div class="status pending" id="tabs-status">‚è≥ Verificando pesta√±as...</div>
        <div class="status pending" id="comm-status">‚è≥ Verificando comunicaci√≥n...</div>
    </div>
    
    <div class="test-card">
        <h2>Flujo de Selecci√≥n de Productos</h2>
        <p>Para probar la selecci√≥n de productos:</p>
        <ol>
            <li>Abre la aplicaci√≥n en <a href="http://127.0.0.1:5002" target="_blank">http://127.0.0.1:5002</a></li>
            <li>Ve a la pesta√±a <strong>"‚úèÔ∏è Editor Descripciones"</strong></li>
            <li>Haz clic en el bot√≥n <strong>"Usar producto real"</strong></li>
            <li>Deber√≠as ser redirigido a la pesta√±a de <strong>"üì¶ Productos"</strong></li>
            <li>Selecciona un producto y verifica que se cargue en el editor</li>
        </ol>
        
        <div id="test-results"></div>
    </div>
    
    <div class="test-card">
        <h2>Acciones de Prueba</h2>
        <button onclick="testServerConnection()">üîç Verificar Servidor</button>
        <button onclick="testAPIEndpoints()">üîå Probar APIs</button>
        <button onclick="simulateProductSelection()">üéØ Simular Selecci√≥n</button>
    </div>
    
    <div class="test-card">
        <h2>Logs</h2>
        <pre id="logs">Esperando acciones...</pre>
    </div>

    <script>
        const log = (message) => {
            const logs = document.getElementById('logs');
            logs.textContent += '\n' + new Date().toLocaleTimeString() + ' - ' + message;
            logs.scrollTop = logs.scrollHeight;
        };

        // Verificar conexi√≥n al servidor
        async function testServerConnection() {
            try {
                log('Verificando conexi√≥n al servidor...');
                const response = await fetch('http://127.0.0.1:5002/health');
                const data = await response.json();
                
                if (data.status === 'ok') {
                    document.getElementById('server-status').className = 'status success';
                    document.getElementById('server-status').textContent = '‚úÖ Servidor activo';
                    log('Servidor conectado correctamente: ' + JSON.stringify(data));
                } else {
                    throw new Error('Estado del servidor no es OK');
                }
            } catch (error) {
                document.getElementById('server-status').className = 'status error';
                document.getElementById('server-status').textContent = '‚ùå Error de servidor';
                log('Error: ' + error.message);
            }
        }

        // Probar endpoints del editor
        async function testAPIEndpoints() {
            const endpoints = [
                '/api/ai-generator/versions',
                '/api/ai-generator/version/base'
            ];
            
            log('Probando endpoints del editor...');
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch('http://127.0.0.1:5002' + endpoint);
                    const data = await response.json();
                    log(`‚úÖ ${endpoint}: ${response.status} - ${JSON.stringify(data).substring(0, 100)}...`);
                } catch (error) {
                    log(`‚ùå ${endpoint}: Error - ${error.message}`);
                }
            }
        }

        // Simular selecci√≥n de producto
        function simulateProductSelection() {
            log('Simulando selecci√≥n de producto...');
            
            const testProduct = {
                nombre: 'Grupo Electr√≥geno TEST',
                marca: 'Honda',
                modelo: 'EU70is-TEST',
                familia: 'Grupos Electr√≥genos',
                potencia_kva: '7',
                potencia_kw: '5.5',
                motor: 'Honda GX390',
                combustible: 'Nafta',
                caracteristicas: 'Test de comunicaci√≥n entre m√≥dulos'
            };
            
            log('Producto de prueba: ' + JSON.stringify(testProduct, null, 2));
            
            // Abrir nueva ventana para simular
            const newWindow = window.open('http://127.0.0.1:5002', '_blank');
            
            setTimeout(() => {
                log('Enviando mensaje de selecci√≥n...');
                // Este mensaje simular√≠a lo que hace el m√≥dulo de productos
                newWindow.postMessage({
                    type: 'product-selected-for-editor',
                    product: testProduct
                }, 'http://127.0.0.1:5002');
            }, 2000);
        }

        // Verificar pesta√±as
        async function checkTabs() {
            try {
                const response = await fetch('http://127.0.0.1:5002');
                const html = await response.text();
                
                const tabs = ['Productos', 'Navegaci√≥n', 'Generador IA', 'Editor Descripciones'];
                let allTabsFound = true;
                
                tabs.forEach(tab => {
                    if (html.includes(tab)) {
                        log(`‚úÖ Pesta√±a encontrada: ${tab}`);
                    } else {
                        log(`‚ùå Pesta√±a no encontrada: ${tab}`);
                        allTabsFound = false;
                    }
                });
                
                if (allTabsFound) {
                    document.getElementById('tabs-status').className = 'status success';
                    document.getElementById('tabs-status').textContent = '‚úÖ Todas las pesta√±as encontradas';
                } else {
                    document.getElementById('tabs-status').className = 'status error';
                    document.getElementById('tabs-status').textContent = '‚ùå Faltan pesta√±as';
                }
            } catch (error) {
                document.getElementById('tabs-status').className = 'status error';
                document.getElementById('tabs-status').textContent = '‚ùå Error verificando pesta√±as';
                log('Error: ' + error.message);
            }
        }

        // Inicializar pruebas
        window.onload = () => {
            log('Iniciando pruebas autom√°ticas...');
            testServerConnection();
            checkTabs();
        };
    </script>
</body>
</html>
